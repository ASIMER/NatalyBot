{% extends "dashboard_template.html" %}
{% block navbar_brand %}
    <a class="navbar-brand" href="{{ url_for('users') }}"> Пользовательская панель </a>
{% endblock %}
{% block notifications %}
    <li class="dropdown nav-item">
        <a href="#" class="dropdown-toggle nav-link"
           data-toggle="dropdown">
            <i class="nc-icon nc-planet"></i>
            <span class="notification">11</span>
            <span class="d-lg-none">Оповещения</span>
        </a>
        <ul class="dropdown-menu">
            <a class="dropdown-item" href="#">Оповещение
                1</a>
            <a class="dropdown-item" href="#">Оповещение
                2</a>
            <a class="dropdown-item" href="#">Оповещение
                3</a>
            <a class="dropdown-item" href="#">Оповещение
                4</a>
            <a class="dropdown-item" href="#">Ёще
                оповещения...</a>
        </ul>
    </li>
{% endblock %}
{% block dropdown_menu %}
    <div class="dropdown-menu"
         aria-labelledby="navbarDropdownMenuLink">
        <a class="dropdown-item"
           href="{{ url_for('access') }}">Доступ к профилям</a>
        <a class="dropdown-item" href="#">Another
            action</a>
        <a class="dropdown-item"
           href="#">Something</a>
        <a class="dropdown-item" href="#">Something
            else here</a>
        <div class="divider"></div>
        <a class="dropdown-item" href="{{ url_for('users') }}">Пользователи</a>
    </div>
{% endblock %}
{% block content %}
    <div class="content">
        <div class="container-fluid">
            <div class="container mb-3 mt-3">
                <div class="row">
                    <div class="col-md-14">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <h4 style="margin-top: auto;">
                                        Заполните форму для просмотра
                                        доступа пользователя
                                        &#8595;</h4>
                                </div>
                            </div>
                            <div class="card-body">
                                <form method="post"
                                      action="{{ url_for('access') }}">
                                    <input type="hidden" name="csrf_token"
                                           value="{{ csrf_token() }}"/>
                                    <div class="form-group">
                                        <label for="user_login_select">Выбрерите
                                            пользователя просмотра
                                            профилей</label>
                                        <select class="form-control"
                                                id="user_login_select"
                                                name="user_login"
                                                onchange="run()">
                                            <option disabled selected
                                                    value="disabled">
                                                Доступные пользователи
                                            </option>
                                            {% if users %}
                                                {% for user in users %}
                                                    <option value="{{ user[0] }}"
                                                            {% if
                                                            selected_user == user[0] %}
                                                            selected
                                                            {% endif %}>
                                                        {{ user[0] }}
                                                    </option>
                                                {% endfor %}
                                            {% endif %}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label style="color: black;"
                                               for="user_login_manual">
                                            Ввод e-mail вручную
                                        </label>
                                        <input type="text"
                                               class="form-control"
                                               id="user_login_manual"
                                               name="user_login_manual"
                                               placeholder="e-mail пользователя">
                                    </div>
                                    <input type="submit"
                                           style="margin-top: 30px; margin-left: 25%; width: 50%;"
                                           class="btn btn-fill
                                               btn-round btn-success"
                                           value="Показать доступные профили">
                                    {% if selected_user %}
                                        <div class="form-group">
                                            <label for="profile_id_select">
                                                Выбрерите профиль который
                                                добавить
                                            </label>
                                            <select class="form-control"
                                                    id="profile_id_select"
                                                    name="profile_id"
                                                    onchange="run()">
                                                <option disabled selected
                                                        value="disabled">
                                                    Доступные для добавления
                                                    профили
                                                </option>
                                                {% if profiles %}
                                                    {% for profile in profiles %}
                                                        <option value="{{ profile[0] }}">
                                                            {{ profile[0] }}
                                                        </option>
                                                    {% endfor %}
                                                {% endif %}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label style="color: black;"
                                                   for="profile_id_manual">
                                                Ввод ID профиля вручную
                                            </label>
                                            <input type="text"
                                                   class="form-control"
                                                   id="profile_id_manual"
                                                   name="profile_id_manual"
                                                   placeholder="ID профиля">
                                        </div>
                                        <input type="submit"
                                               style="margin-top: 30px; margin-left: 25%; width: 50%;"
                                               class="btn btn-fill
                                               btn-round btn-success"
                                               value="Добавить доступ к профилю">
                                    {% endif %}
                                </form>
                            </div>
                        </div>
                        <div id="toolbar" style="padding-bottom: 20px;">
                            <button type="button" id="delete"
                                    class="btn btn-fill btn-danger">Удалить
                            </button>
                        </div>
                        <table id="table"
                               class="table table-striped table table-bordered mydatatable"
                               style="width: 100%">
                            <thead>
                            <tr>
                                <th data-field="num">№</th>
                                <th data-field="select">Выбор</th>
                                <th data-field="profile_id">Prifile ID</th>
                                <th data-field="action" data-sortable="false">
                                    Действия
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            {% if available_profiles %}
                                {% for i in range(available_profiles|length) %}
                                    <tr>
                                        <td align="center">{{ i + 1 }}</td>
                                        <td align="center"><input
                                                type="checkbox"
                                                class="checkbox"></td>
                                        <td align="center">{{ available_profiles[i][0] }}</td>
                                        <td class="td-actions" align="center">
                                            <a rel="tooltip"
                                               title="Просмотреть профиль"
                                               class="btn-sm table-action view"
                                               style="color: blue;"
                                               href="javascript:void(0)">
                                                <i class="fa fa-user"></i>
                                            </a>
                                            <a rel="tooltip" title="Изменить"
                                               class="btn-sm table-action edit"
                                               style="color: green;"
                                               href="javascript:void(0)">
                                                <i class="fa fa-edit"></i>
                                            </a>
                                            <a rel="tooltip" title="Удалить"
                                               class="btn-sm table-action remove"
                                               style="color: red;"
                                               href="javascript:void(0)">
                                                <i class="fa fa-times"></i>
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                            </tbody>
                            <tfoot>
                            <tr>
                                <th>№</th>
                                <th>Выбор</th>
                                <th>Profile ID</th>
                                <th>Действия</th>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <script>
                    function run() {
                        document.getElementById("srt").value = document.getElementById("profileselect").value;
                    }
                </script>

            </div>
        </div>
    </div>
{% endblock %}


{% block scripts %}
    {{ super() }}

    <!-- Scripts for dataTable -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script> -->

    <script src="{{ url_for('static',
                    filename='js/jquery.dataTables.js') }}"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.js"></script>
    <script>
        $('.mydatatable').DataTable();
    </script>
{% endblock %}